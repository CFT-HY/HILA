\doxysection{test\+\_\+conj\+Reduce.\+cpp}
\hypertarget{test__conjReduce_8cpp_source}{}\label{test__conjReduce_8cpp_source}\index{test\_conjReduce.cpp@{test\_conjReduce.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}test.h"{}}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ "{}plumbing/input.h"{}}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00014}00014\ \textcolor{comment}{//\ TODO:\ rng\ definition\ that\ works\ for\ MPI,\ GPU\ and\ CPU}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00016}00016\ \textcolor{keywordtype}{int}\ main(\textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}\ **argv)\ \{}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00017}00017\ \ \ \ \ seed\_mersenne(4l);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00018}00018\ \ \ \ \ \textcolor{keywordtype}{double}\ dsum\ =\ 0;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00019}00019\ \ \ \ \ \textcolor{keywordtype}{int}\ isum\ =\ 0;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00020}00020\ \ \ \ \ test\_setup(argc,\ argv);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00022}00022\ \ \ \ \ \textcolor{comment}{//\ Test\ input\ class\ -\/\ should\ be\ possible\ to\ call\ before\ or\ after\ setup}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00023}00023\ \ \ \ \ hila::input\ a(\textcolor{stringliteral}{"{}params.txt"{}});}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00024}00024\ \ \ \ \ \textcolor{keywordtype}{int}\ nx\ =\ a.get(\textcolor{stringliteral}{"{}nx"{}});}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00025}00025\ \ \ \ \ std::string\ \mbox{\hyperlink{namespacehila_a5332679ab5ee4d7c673c633eb5b0f8c2}{out}}\ =\ a.get(\textcolor{stringliteral}{"{}output"{}});}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00027}00027\ \ \ \ \ \mbox{\hyperlink{classField}{Field<Matrix<2,\ 2,\ double>}}>\ matrices;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00028}00028\ \ \ \ \ \mbox{\hyperlink{classField}{Field<int>}}\ coordinate,\ nb\_coordinate1,\ nb\_coordinate2;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00029}00029\ \ \ \ \ \mbox{\hyperlink{classField}{Field<SU<4,\ double>}}>\ sufield;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00031}00031\ \ \ \ \ \textcolor{comment}{//\ check\ that\ fieldstruct\ allocated\ only\ after\ assignment}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00032}00032\ \ \ \ \ assert(matrices.\mbox{\hyperlink{classField_a9f12ebc3ba5eeb4c781c484e244e3a55}{fs}}\ ==\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00034}00034\ \ \ \ \ \textcolor{comment}{//\ Test\ that\ neighbours\ are\ gathered\ correctly}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00035}00035\ \ \ \ \ foralldir(dir)\ \{}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00036}00036\ \ \ \ \ \ \ \ \ onsites(ALL)\ \{}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00037}00037\ \ \ \ \ \ \ \ \ \ \ \ \ element<CoordinateVector>\ l\ =\ X.coordinates();}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00038}00038\ \ \ \ \ \ \ \ \ \ \ \ \ coordinate[X]\ =\ l[dir];}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00039}00039\ \ \ \ \ \ \ \ \ \ \ \ \ nb\_coordinate1[X]\ =\ (l[dir]\ +\ 1)\ \%\ nd[dir];}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00040}00040\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00042}00042\ \ \ \ \ \ \ \ \ nb\_coordinate2[ALL]\ =\ coordinate[X\ +\ dir];}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00044}00044\ \ \ \ \ \ \ \ \ onsites(ALL)\ \{}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00045}00045\ \ \ \ \ \ \ \ \ \ \ \ \ element<int>\ diff\ =\ nb\_coordinate1[X]\ -\/\ nb\_coordinate2[X];}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00046}00046\ \ \ \ \ \ \ \ \ \ \ \ \ isum\ +=\ diff\ *\ diff;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00047}00047\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00048}00048\ \ \ \ \ \ \ \ \ assert(isum\ ==\ 0\ \&\&\ \textcolor{stringliteral}{"{}Value\ gathered\ from\ neighbour\ is\ correct"{}});}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00049}00049\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00051}00051\ \textcolor{comment}{//\ If\ MPI\ is\ defined,\ check\ that\ gathers\ are\ counted\ correctly}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00052}00052\ \textcolor{preprocessor}{\#ifdef\ MPI}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00053}00053\ \ \ \ \ coordinate[ALL]\ =\ 1;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00054}00054\ \ \ \ \ lattices[0]-\/>n\_gather\_done\ =\ 0;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00055}00055\ \ \ \ \ lattices[0]-\/>n\_gather\_avoided\ =\ 0;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00057}00057\ \ \ \ \ nb\_coordinate2[ALL]\ =\ coordinate[X\ -\/\ e\_x];}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00058}00058\ \ \ \ \ assert(lattices[0]-\/>n\_gather\_done\ ==\ 1);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00059}00059\ \ \ \ \ assert(lattices[0]-\/>n\_gather\_avoided\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00060}00060\ \ \ \ \ nb\_coordinate2[ALL]\ =\ coordinate[X\ -\/\ e\_x];}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00061}00061\ \ \ \ \ assert(lattices[0]-\/>n\_gather\_done\ ==\ 1);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00062}00062\ \ \ \ \ assert(lattices[0]-\/>n\_gather\_avoided\ ==\ 1);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00063}00063\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00065}00065\ \ \ \ \ \textcolor{comment}{//\ Test\ matrix\ multiplication\ and\ neighbour\ gathers}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00066}00066\ \ \ \ \ \textcolor{comment}{//\ Calculates\ M(X)\ *\ M.congugate(X+dir)}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00067}00067\ \ \ \ \ onsites(ALL)\ \{}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00068}00068\ \ \ \ \ \ \ \ \ element<Matrix<2,\ 2,\ double>>\ a;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00069}00069\ \ \ \ \ \ \ \ \ element<double>\ theta\ =}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ 2.0\ *\ M\_PI\ *\ \mbox{\hyperlink{namespacehila_a619e441d1ebadab1a5d1d3f08b88fb42}{hila::random}}();\ \textcolor{comment}{//\ make\ a\ random\ rotation\ matrix\ at\ each\ even\ site}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00071}00071\ \ \ \ \ \ \ \ \ a.c[0][0]\ =\ cos(theta);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00072}00072\ \ \ \ \ \ \ \ \ a.c[0][1]\ =\ -\/sin(theta);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00073}00073\ \ \ \ \ \ \ \ \ a.c[1][0]\ =\ sin(theta);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00074}00074\ \ \ \ \ \ \ \ \ a.c[1][1]\ =\ cos(theta);}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00075}00075\ \ \ \ \ \ \ \ \ matrices[X]\ =\ a;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00076}00076\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00077}00077\ \ \ \ \ assert(matrices.\mbox{\hyperlink{classField_a9f12ebc3ba5eeb4c781c484e244e3a55}{fs}}\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00079}00079\ \ \ \ \ matrices[ODD]\ =}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00080}00080\ \ \ \ \ \ \ \ \ matrices[X\ -\/\ e\_x].conjugate();\ \textcolor{comment}{//\ odd\ matrices\ are\ the\ conjugate\ of\ the\ previous}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ even\ site\ in\ the\ X\ Direction}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00083}00083\ \ \ \ \ onsites(EVEN)\ \{}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ matrices[X]\ *=}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ matrices[X\ +\ e\_x];\ \textcolor{comment}{//\ multiply\ the\ even\ sites\ with\ the\ matrices\ stored\ in\ the}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ neighboring\ odd\ site\ in\ X\ Direction}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00087}00087\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00088}00088\ \ \ \ \ onsites(ODD)\ \{}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00089}00089\ \ \ \ \ \ \ \ \ matrices[X]\ *=\ matrices[X].conjugate();\ \textcolor{comment}{//\ multiply\ odd\ sites\ by\ their\ conjugate}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00090}00090\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00092}00092\ \ \ \ \ \textcolor{comment}{//\ now\ all\ sites\ should\ be\ unit\ matrices}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00094}00094\ \ \ \ \ dsum\ =\ 0;}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00095}00095\ \ \ \ \ onsites(ALL)\ \{\ dsum\ +=\ matrices[X].trace();\ \}}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00097}00097\ \ \ \ \ assert(((\textcolor{keywordtype}{int})dsum)\ ==\ lattice.volume()\ *\ 2\ \&\&\ \textcolor{stringliteral}{"{}Matrix\ conjugate\ multiplication"{}});}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00099}00099\ \ \ \ \ \mbox{\hyperlink{namespacehila_ac4c73fee5aec8618b5c933a67822de1e}{hila::finishrun}}();}
\DoxyCodeLine{\Hypertarget{test__conjReduce_8cpp_source_l00100}00100\ \}}

\end{DoxyCode}
