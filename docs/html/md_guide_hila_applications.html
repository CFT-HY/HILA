<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HILA: Building you first HILA application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HILA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_guide_hila_applications.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Building you first HILA application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section goes over how to get started with HILA and building your first HILA application</p>
<h1><a class="anchor" id="autotoc_md0"></a>
HILA Application</h1>
<p>Like most c++ applications, HILA applications require two thing, a makefile and application source code. Due to the functionality that HILA offers, the makefile and source code follow a well defined structure. Generally HILA applications are at their core c++ and the user is free to implement any methods and libraries they see fit. But to implement the functionality that the pre processor offers, a well defined skeleton is introduced.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Makefile system</h2>
<p>Each application requires a makefile to link the necessary HILA libraries and to allow specification of the target backend. An application makefile should define any target files and include the main makefile defined for the HILA libraries. The main makefile handles the HILA library linking and inclusion of the target backend.</p>
<p>Here is an example with comments: </p><div class="fragment"><div class="line">#NECESSARY</div>
<div class="line"># Give the location of the top level distribution directory wrt. this.</div>
<div class="line"># Can be absolute or relative</div>
<div class="line"># Allows the application folder to be defined anywhere in the machine</div>
<div class="line">HILA_DIR := ../..</div>
<div class="line"> </div>
<div class="line"># Set default goal</div>
<div class="line">.DEFAULT_GOAL := applications</div>
<div class="line"> </div>
<div class="line">#Set default architecture </div>
<div class="line">ifndef ARCH</div>
<div class="line">ARCH := vanilla</div>
<div class="line">endif</div>
<div class="line"> </div>
<div class="line"># Add an application specific header to the dependencies</div>
<div class="line">APP_HEADERS := application.h</div>
<div class="line"> </div>
<div class="line"># Read in the main makefile contents to link and build HILA libraries</div>
<div class="line">include $(TOP_DIR)/libraries/main.mk</div>
<div class="line"> </div>
<div class="line"># With multiple targets we want to use &quot;make target&quot;, not &quot;make build/target&quot;.</div>
<div class="line"># This is needed to build the dependencies in the build subdirectory</div>
<div class="line">application: build/application ; @:</div>
<div class="line"> </div>
<div class="line"># Now the linking step for each target executable</div>
<div class="line">build/application: Makefile build/application.o $(HILA_OBJECTS) $(HEADERS) </div>
<div class="line">    $(LD) -o $@ build/application.o $(HILA_OBJECTS) $(LDFLAGS) $(LDLIBS)</div>
</div><!-- fragment --><p>TODO: <b>Should the above makefile illustrate which aspects are necessary and which are not</b></p>
<p>The target backends are defined in the folder HILA/libraries/target_arch. There are two types of target backends. General ones defined for specific paralellization technologies:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ARCH=   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>vanilla</code>   </td><td class="markdownTableBodyNone">default CPU implementation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>AVX2</code>   </td><td class="markdownTableBodyNone">AVX vectorization optimized program using <a href="https://github.com/vectorclass"><em>vectorclass</em></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>openmp</code>   </td><td class="markdownTableBodyNone">OpenMP parallelized program    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>cuda</code>   </td><td class="markdownTableBodyNone">Parallel <a href="https://developer.nvidia.com/cuda-toolkit">CUDA</a> program    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>hip</code>   </td><td class="markdownTableBodyNone">Parallel <a href="https://docs.amd.com/bundle/HIP-Programming-Guide-v5.3/page/Introduction_to_HIP_Programming_Guide.html">HIP</a>   </td></tr>
</table>
<p>And ones which are defined for specific HPC platforms:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ARCH   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>lumi</code>   </td><td class="markdownTableBodyNone">CPU-MPI implementation for LUMI supercomputer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>lumi-hip</code>   </td><td class="markdownTableBodyNone">GPU-MPI implementation for LUMI supercomputer using HIP    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>mahti</code>   </td><td class="markdownTableBodyNone">CPU-MPI implementation for MAHTI supercomputer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>mahti-cuda</code>   </td><td class="markdownTableBodyNone">GPU-MPI implementation for MAHTI supercomputer using CUDA   </td></tr>
</table>
<p>The latter definitions are due to the module systems and non-standard paths defined by supercomputing platforms.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Simple hila application</h2>
<p>A simple HILA application which computes a random gaussian field (f), it's derivative (g) and the average of the derivative field is given by:</p>
<div class="fragment"><div class="line">#include &quot;hila.h&quot;</div>
<div class="line">static_assert(NDIM == 3, &quot;NDIM must be 3&quot;);</div>
<div class="line"> </div>
<div class="line">int main(int argc, char * argv[]) {</div>
<div class="line"> </div>
<div class="line">    hila::initialize(argc,argv);</div>
<div class="line"> </div>
<div class="line">    // set up 32^3 lattice</div>
<div class="line">    lattice.setup({32,32,32});</div>
<div class="line"> </div>
<div class="line">    // Random numbers are used here</div>
<div class="line">    hila::seed_random(32345);</div>
<div class="line"> </div>
<div class="line">    Field&lt;Complex&lt;double&gt;&gt; f;</div>
<div class="line">    Field&lt;double&gt; g = 0;</div>
<div class="line"> </div>
<div class="line">    // make f Gaussian random distributed</div>
<div class="line">    onsites(ALL) f[X].gaussian();</div>
<div class="line"> </div>
<div class="line">    // calculate sum of 2nd derivatives of f in to g</div>
<div class="line">    foralldir(d) {</div>
<div class="line">        g[ALL] += abs(f[X+d] - 2*f[X] + f[X-d]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    // get average of g</div>
<div class="line">    double average = 0;</div>
<div class="line">    onsites(ALL) {</div>
<div class="line">        average += g[X];</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    average = average/lattice.volume()</div>
<div class="line">    hila::out0 &lt;&lt; &quot;Average of g is &quot; &lt;&lt; average &lt;&lt; &#39;\n&#39;;</div>
<div class="line"> </div>
<div class="line">    // make a clean exit</div>
<div class="line">    hila::finishrun();    </div>
<div class="line">}</div>
</div><!-- fragment --><p>One can compile this code at <code>HILA/applications/hila_example/</code> with <code>make simple</code> and run it with <code>./build/simple</code>.</p>
<p>TODO: <b>CONTINUE FROM HERE</b> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
