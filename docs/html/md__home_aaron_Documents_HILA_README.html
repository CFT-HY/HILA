<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HILA: Description and Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HILA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_aaron_Documents_HILA_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Description and Installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Hila (lattice in Finnish) is a C++ lattice field theory programming framework, aimed at HPC simulations. <br  />
</p>
<p>Purpose: make writing applications straightforward and intuitive, while producing optimized executables for different (super)computing platforms (parallelization with MPI, GPU computing with Cuda or HIP, AVX vectorization, etc.). Details of the parallelization and computing architecture are hidden from the user's view, and all applications automatically run on present or future platform. Write once &ndash; run anywhere.</p>
<p>Hila is based on hila preprocessor "hilapp", which is a C++ source-to-source transformer using the <a href="https://clang.llvm.org/docs/LibTooling.html">libtooling</a> toolbox of the <a href="https://clang.llvm.org/">Clang</a> compiler. It converts application C++ to platform-specific C++ code, which is passed to appropriate compilers for the platforms.</p>
<p>Behind the scenes hila takes care of MPI layout and communications. It lays out the lattice fields differently for different computing platforms: 'array of structures' (standard), 'array of structures of vectors' (AVX-type), or 'structure of arrays' (GPU-type).</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Table of Contents</h1>
<ol type="1">
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#user-guide">User Guide</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md9"></a>
Dependencies</h1>
<h2><a class="anchor" id="autotoc_md10"></a>
Hilapp</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Dependencies   </th><th class="markdownTableHeadNone">Minimum Version   </th><th class="markdownTableHeadNone">Required    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Clang   </td><td class="markdownTableBodyNone">8 -   </td><td class="markdownTableBodyNone">Yes   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md11"></a>
Installing dependencies for HILA preprocessor:</h3>
<p>See installation guide, since may not be necessary.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
HILA applications</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Dependencies   </th><th class="markdownTableHeadNone">Minimum Version   </th><th class="markdownTableHeadNone">Required    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Clang / GCC   </td><td class="markdownTableBodyNone">8 - / x   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FFTW3   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MPI   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OpenMP   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">No    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CUDA   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">No    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">HIP   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">No   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md13"></a>
Installing dependencies for HILA applications:</h3>
<p>Installing all non GPU dependencies on ubuntu: </p><div class="fragment"><div class="line">apt install build-essential \</div>
<div class="line">            libopenmpi-dev \</div>
<div class="line">            libfftw3-dev \</div>
<div class="line">            libomp-dev</div>
</div><!-- fragment --><p><b>CUDA:</b></p>
<p>See NVIDIA drivers and CUDA documentation: <a href="https://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html">https://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html</a></p>
<p><b>HIP:</b></p>
<p>See ROCm and HIP documentation: <a href="https://docs.amd.com/">https://docs.amd.com/</a>, <a href="https://rocmdocs.amd.com/en/latest/Installation_Guide/HIP-Installation.html">https://rocmdocs.amd.com/en/latest/Installation_Guide/HIP-Installation.html</a></p>
<h1><a class="anchor" id="autotoc_md14"></a>
Installation</h1>
<p>When it comes to installing HILA applications there are many avenues one can take depending on the platform. There are options available with containerization and installation from source, depending on the users platform:</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Containers</h2>
<p>HILA comes with both a singularity and docker container for differing purposes. The aim is to make use easy on any platform be it linux, mac, windows or a supercomputer.</p>
<p><b>Docker</b></p>
<p>The docker container is meant to develop and produce HILA applications, libraries and hilapp with ease. One can produce HILA applications on their local machine and run them in a container without having to worry about dependencies. Note that there is overhead when running MPI communication in docker, thus one will not get optimal simulation performance when running highly paralelled code in a container. This is a non issue with small scale simulations or testing.</p>
<p>For instructions on using the docker container have a look at the <a class="el" href="md__home_aaron_Documents_HILA_docker_README.html">README.md</a> in the docker folder</p>
<p><b>Singularity</b></p>
<p>The singularity container offers a more packaged approach where one doesn't need to worry about clang libtoolbox support for compiling the HILA pre processor. Hence for HPC platforms where the access of such compiler libraries can be tedious one can simply opt to use the container version of hilapp. This approach is mainly meant to be used for pre processing applications on an HPC platform.</p>
<p>For instructions on installing singularity and building containers have a look at the <a class="el" href="md__home_aaron_Documents_HILA_singularity_README.html">README.md</a> in the singularity folder</p>
<h2><a class="anchor" id="autotoc_md16"></a>
From source</h2>
<p>Begin by cloning HILA repository:</p>
<div class="fragment"><div class="line">git clone https://github.com/CFT-HY/HILA</div>
</div><!-- fragment --><p>The HILA working method is split into two parts. The first part is getting access to the hilapp preprocessor. And the second part is building simulations for targeted architectures and technologies using the hilapp preprocessor.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
1. HILA preprocessor</h3>
<p>The preprocessor can be accessed either by compiling from source using the clang libtooling toolbox or by using the offered singularity container mentioned above.</p>
<p>For building <em>hilapp</em>, you need <a href="https://clang.llvm.org/">clang</a> development tools (actually, only include files). These can be found in most Linux distribution repos, e.g. in Ubuntu 22.04:</p>
<div class="fragment"><div class="line">export LLVM_VERSION=15</div>
<div class="line">apt-get -y install clang-$LLVM_VERSION \</div>
<div class="line">                   libclang-$LLVM_VERSION-dev</div>
</div><!-- fragment --><p>Compile <em>hilapp</em>:</p>
<div class="fragment"><div class="line">cd hila/hilapp</div>
<div class="line">make [-j4]</div>
<div class="line">make install</div>
</div><!-- fragment --><p>This builds <em>hilapp</em> in hila/hilapp/build, and <code>make install</code> moves it to hila/hilapp/bin, which is the default location for the program. Build takes 1-2 min.</p>
<p>("By default, hilapp Makefile uses clang++ installed in stage 1. You can also use g++ with `make CXX=g++`." Is this detail too complicated? Should just stick to clang in this part.)</p>
<ul>
<li><em>NOTE: clang dev libraries are not installed in most supercomputer systems. However, if the system has x86_64 processors (by far most common), you can use <code>make static</code> -command to build statically linked hilapp. Copy <code>hila/hilapp/build/hilapp</code> to directory <code>hila/hilapp/bin</code> on the target machine. Simpler approach for HPC platforms is use of singularity containers</em></li>
</ul>
<p>Test that hilapp works </p><pre class="fragment">./bin/hilapp --help
</pre><h3><a class="anchor" id="autotoc_md18"></a>
2. Building HILA applications</h3>
<p>The second part is building HILA applications. Here we will go over a test example. All applications should lie in the applications folder.</p>
<ul>
<li><em>NOTE: that at this point one will need to install the FFTW3 and OpenMPI development libraries, see dependencies section</em></li>
</ul>
<p>Build an application: </p><div class="fragment"><div class="line">cd hila/applications/hila_example</div>
<div class="line">make [-j4]</div>
<div class="line">./build/hila_example</div>
</div><!-- fragment --><p> By default all HILA applications are built using MPI so one can run directly: </p><pre class="fragment">mpirun -n 4 ./build/hila_example
</pre><p>Computing platform is chosen by </p><pre class="fragment">make ARCH=&lt;platform&gt;
</pre><p> <b>List of computing platforms:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ARCH=   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>vanilla</code>   </td><td class="markdownTableBodyNone">default CPU implementation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>AVX2</code>   </td><td class="markdownTableBodyNone">AVX vectorization optimized program using <a href="https://github.com/vectorclass"><em>vectorclass</em></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>openmp</code>   </td><td class="markdownTableBodyNone">OpenMP parallelized program    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>cuda</code>   </td><td class="markdownTableBodyNone">Parallel <a href="https://developer.nvidia.com/cuda-toolkit">CUDA</a> program    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>hip</code>   </td><td class="markdownTableBodyNone">Parallel <a href="https://docs.amd.com/bundle/HIP-Programming-Guide-v5.3/page/Introduction_to_HIP_Programming_Guide.html">HIP</a>   </td></tr>
</table>
<p>For cuda compilation one needs to define their CUDA version and architercure either as environment variables or during the make process:</p>
<div class="fragment"><div class="line">export CUDA_VERSION=11.6</div>
<div class="line">export CUDA_ARCH=61</div>
<div class="line">make ARCH=cuda</div>
<div class="line">or</div>
<div class="line">make ARCH=cuda CUDA_VERSION=11.6 CUDA_ARCH=61</div>
</div><!-- fragment --><p> <em>NOTE: Default cuda version is 11.6 and compute architecture is sm_61</em></p>
<p><b>HPC platforms</b>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ARCH   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>lumi</code>   </td><td class="markdownTableBodyNone">CPU-MPI implementation for LUMI supercomputer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>lumi-hip</code>   </td><td class="markdownTableBodyNone">GPU-MPI implementation for LUMI supercomputer using HIP    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>mahti</code>   </td><td class="markdownTableBodyNone">CPU-MPI implementation for MAHTI supercomputer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>mahti-cuda</code>   </td><td class="markdownTableBodyNone">GPU-MPI implementation for MAHTI supercomputer using CUDA   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md19"></a>
User guide</h1>
<p>Now that HILA has been built successfully, navigate to the user guide on how to build hila applications: guide</p>
<p>To generate the user guide and technical documentation locally (TODO: should be running on a web interface) one can run </p><pre class="fragment">doxygen /docs/config 
</pre><p> To open the documentation locally with any browser </p><pre class="fragment">firefox /docs/html/index.html
</pre><p> TODO: add link to github pages or hosted guide somewhere </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
