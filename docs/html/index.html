<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HILA: Description and Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HILA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Description and Installation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="mainpage"></a></p>
<p>Hila (lattice in Finnish) is a C++ lattice field theory programming framework, aimed at HPC simulations. <br  />
</p>
<p>Purpose: make writing applications straightforward and intuitive, while producing optimized executables for different (super)computing platforms (parallelization with MPI, GPU computing with Cuda or HIP, AVX vectorization, etc.). Details of the parallelization and computing architecture are hidden from the user's view, and all applications automatically run on present or future platform. Write once &ndash; run anywhere.</p>
<p>Hila is based on hila preprocessor "hilapp", which is a C++ source-to-source transformer using the <a href="https://clang.llvm.org/docs/LibTooling.html">libtooling</a> toolbox of the <a href="https://clang.llvm.org/">Clang</a> compiler. It converts application C++ to platform-specific C++ code, which is passed to appropriate compilers for the platforms.</p>
<p>Behind the scenes hila takes care of MPI layout and communications. It lays out the lattice fields differently for different computing platforms: 'array of structures' (standard), 'array of structures of vectors' (AVX-type), or 'structure of arrays' (GPU-type).</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Table of Contents</h1>
<ol type="1">
<li><a class="el" href="index.html#dependencies">Dependencies</a></li>
<li><a class="el" href="index.html#installation">Installation</a></li>
<li><a class="el" href="index.html#user-guide">User Guide</a></li>
</ol>
<h1><a class="anchor" id="dependencies"></a>
Dependencies</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Hilapp</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Dependencies   </th><th class="markdownTableHeadNone">Minimum Version   </th><th class="markdownTableHeadNone">Required    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Clang   </td><td class="markdownTableBodyNone">8 -   </td><td class="markdownTableBodyNone">Yes   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md10"></a>
Installing dependencies for HILA preprocessor:</h3>
<p>If one opts to use a singularity container skip to HILA applications dependencies.</p>
<p>If one opts to use a docker container, skip directly to the <a class="el" href="index.html#installation">installation</a> section.</p>
<p>For building <em>hilapp</em>, you need <a href="https://clang.llvm.org/">clang</a> development tools (actually, only include files). These can be found in most Linux distribution repos, e.g. in Ubuntu 22.04:</p>
<div class="fragment"><div class="line">export LLVM_VERSION=15</div>
<div class="line">sudo apt-get -y install clang-$LLVM_VERSION \</div>
<div class="line">                   libclang-$LLVM_VERSION-dev</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
HILA applications</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Dependencies   </th><th class="markdownTableHeadNone">Minimum Version   </th><th class="markdownTableHeadNone">Required    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Clang / GCC   </td><td class="markdownTableBodyNone">8 - / x   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FFTW3   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MPI   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OpenMP   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">No    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CUDA   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">No    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">HIP   </td><td class="markdownTableBodyNone">x   </td><td class="markdownTableBodyNone">No   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md12"></a>
Installing dependencies for HILA applications:</h3>
<p>If one opts to use docker, skip directly to the <a class="el" href="index.html#installation">installation</a> section.</p>
<p>Installing all non GPU dependencies on ubuntu: </p><div class="fragment"><div class="line">sudo apt install build-essential \</div>
<div class="line">            libopenmpi-dev \</div>
<div class="line">            libfftw3-dev \</div>
<div class="line">            libomp-dev</div>
</div><!-- fragment --><p><b>CUDA:</b></p>
<p>See NVIDIA drivers and CUDA documentation: <a href="https://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html">https://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html</a></p>
<p><b>HIP:</b></p>
<p>See ROCm and HIP documentation: <a href="https://docs.amd.com/">https://docs.amd.com/</a>, <a href="https://rocmdocs.amd.com/en/latest/Installation_Guide/HIP-Installation.html">https://rocmdocs.amd.com/en/latest/Installation_Guide/HIP-Installation.html</a></p>
<h1><a class="anchor" id="installation"></a>
Installation</h1>
<p>Begin by cloning HILA repository:</p>
<div class="fragment"><div class="line">git clone https://github.com/CFT-HY/HILA</div>
</div><!-- fragment --><p>The installation process is split into two parts. Building the HILA preprocessor and compiling HILA applications. Both can be installed from source, and both steps have their respective containerization options available. The variety in options is to address differing issues which arise in platform dependencies.</p>
<p>When it comes to installing HILA applications there are many avenues one can take depending on their platform. The available platforms and offered methods are listed below, which link to the necessary section in the installation guide.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
LINUX</h3>
<p>HILA has originally been developed on linux, hence all of the available options can be used. The HILA preprocessor can be built from <a class="el" href="index.html#hila-preprocessor">source</a> or with the use of a <a class="el" href="index.html#singularity">singualrity</a> container. Additionally one can opt to use the <a class="el" href="index.html#docker">docker</a> container which installs the hila preprocessor directly.</p>
<h3><a class="anchor" id="autotoc_md14"></a>
MAC</h3>
<p>On mac the installation of the HILA preprocessor dependencies and HILA application dependencies can be tedious, and in some cases impossible. Availability of clang libtoolbox is open ended. For this reason the best option is to use the available <a class="el" href="index.html#docker">docker</a> container.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
WINDOWS</h3>
<p>On windows the installation of the HILA preprocessor dependencies and HILA application dependencies are untested. For this reason the best option is to use the available <a class="el" href="index.html#docker">docker</a> container.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
HPC</h3>
<p>On supercomputing platforms the HILA application dependencies are most likely available. The only issue is the availability of the clang libtoolbox which is used in building the HILA preprocessor. Due to the availability of singularity on supercomputing platfroms the best solution is to opt to use the <a class="el" href="index.html#singularity">singularity</a> container.</p>
<p><b>After installing the hila preprocessor with one of the above options one can move on to the <a class="el" href="index.html#building-hila-applications">building HILA applications</a> section.</b></p>
<h2><a class="anchor" id="autotoc_md17"></a>
Containers</h2>
<p>HILA comes with both a singularity and docker container for differing purposes. The aim is to make use easy on any platform be it linux, mac, windows or a supercomputer.</p>
<h3><a class="anchor" id="docker"></a>
Docker</h3>
<p>The docker container is meant to develop and produce HILA applications, libraries and hilapp with ease. One can produce HILA applications on their local machine and run them in a container without having to worry about dependencies. Note that there is overhead when running MPI communication in docker, thus one will not get optimal simulation performance when running highly paralelled code in a container. This is a non issue with small scale simulations or testing.</p>
<p>For instructions on using the docker container have a look at the <a class="el" href="md__2home_2aaron_2Documents_2HILA_2docker_2README.html">README.md</a> in the docker folder</p>
<h3><a class="anchor" id="singularity"></a>
Singularity</h3>
<p>The singularity container offers a more packaged approach where one doesn't need to worry about clang libtoolbox support for compiling the HILA pre processor. Hence for HPC platforms where the access of such compiler libraries can be tedious one can simply opt to use the container version of hilapp. This approach is mainly meant to be used for pre processing applications on an HPC platform.</p>
<p>For instructions on installing singularity and building containers have a look at the <a class="el" href="md__2home_2aaron_2Documents_2HILA_2singularity_2README.html">README.md</a> in the singularity folder</p>
<h2><a class="anchor" id="hila-preprocessor"></a>
HILA preprocessor</h2>
<p>Before building the preprocessor one must first install the dependencies. See the <a class="el" href="index.html#dependencies">dependencies</a></p>
<p>Compile <em>hilapp</em>:</p>
<div class="fragment"><div class="line">cd hila/hilapp</div>
<div class="line">make [-j4]</div>
<div class="line">make install</div>
</div><!-- fragment --><p>This builds <em>hilapp</em> in hila/hilapp/build, and <code>make install</code> moves it to hila/hilapp/bin, which is the default location for the program. Build takes 1-2 min.</p>
<p>("By default, hilapp Makefile uses clang++ installed in stage 1. You can also use g++ with `make CXX=g++`." Is this detail too complicated? Should just stick to clang in this part.)</p>
<ul>
<li><em>NOTE: clang dev libraries are not installed in most supercomputer systems. However, if the system has x86_64 processors (by far most common), you can use <code>make static</code> -command to build statically linked hilapp. Copy <code>hila/hilapp/build/hilapp</code> to directory <code>hila/hilapp/bin</code> on the target machine. Simpler approach for HPC platforms is use of singularity containers</em></li>
</ul>
<p>Test that hilapp works: </p><pre class="fragment">./bin/hilapp --help
</pre> <details >
<summary >
Expected output </summary>
<p></p>
<div class="fragment"><div class="line">$ ./bin/hilapp --help</div>
<div class="line">USAGE: hilapp [options] &lt;source files&gt;</div>
<div class="line"> </div>
<div class="line">OPTIONS:</div>
<div class="line"> </div>
<div class="line">Generic Options:</div>
<div class="line"> </div>
<div class="line">  --help                    - Display available options (--help-hidden for more)</div>
<div class="line">  --help-list               - Display list of available options (--help-list-hidden for more)</div>
<div class="line">  --version                 - Display the version of this program</div>
<div class="line"> </div>
<div class="line">hilapp:</div>
<div class="line"> </div>
<div class="line">  --AVXinfo=&lt;int&gt;           - AVX vectorization information level 0-2. 0 quiet, 1 not vectorizable loops, 2 all loops</div>
<div class="line">  -D &lt;macro[=value]&gt;        - Define name/macro for preprocessor</div>
<div class="line">  -I &lt;directory&gt;            - Directory for include file search</div>
<div class="line">  --allow-func-globals      - Allow using global or extern variables in functions called from site loops.</div>
<div class="line">                              This will not work in kernelized code (for example GPUs)</div>
<div class="line">  --check-init              - Insert checks that Field variables are appropriately initialized before use</div>
<div class="line">  --comment-pragmas         - Comment out &#39;#pragma hila&#39; -pragmas in output</div>
<div class="line">  --dump-ast                - Dump AST tree</div>
<div class="line">  --function-spec-no-inline - Do not mark generated function specializations &quot;inline&quot;</div>
<div class="line">  --gpu-slow-reduce         - Use slow (but memory economical) reduction on gpus</div>
<div class="line">  --ident-functions         - Comment function call types in output</div>
<div class="line">  --insert-includes         - Insert all project #include files in .cpt -files (portable)</div>
<div class="line">  --method-spec-no-inline   - Do not mark generated method specializations &quot;inline&quot;</div>
<div class="line">  --no-include              - Do not insert any &#39;#include&#39;-files (for debug, may not compile)</div>
<div class="line">  --no-interleave           - Do not interleave communications with computation</div>
<div class="line">  --no-output               - No output file, for syntax check</div>
<div class="line">  -o &lt;filename&gt;             - Output file (default: &lt;file&gt;.cpt, write to stdout: -o - </div>
<div class="line">  --syntax-only             - Same as no-output</div>
<div class="line">  --target:AVX              - Generate AVX vectorized loops</div>
<div class="line">  --target:AVX512           - Generate AVX512 vectorized loops</div>
<div class="line">  --target:CUDA             - Generate CUDA kernels</div>
<div class="line">  --target:HIP              - Generate HIP kernels</div>
<div class="line">  --target:openacc          - Offload to GPU using openACC</div>
<div class="line">  --target:openmp           - Hybrid OpenMP - MPI</div>
<div class="line">  --target:vanilla          - Generate loops in place</div>
<div class="line">  --target:vectorize=&lt;int&gt;  - Generate vectorized loops with given vector size </div>
<div class="line">                              For example -target:vectorize=32 is equivalent to -target:AVX</div>
<div class="line">  --verbosity=&lt;int&gt;         - Verbosity level 0-2.  Default 0 (quiet)</div>
</div><!-- fragment --><p></p>
</details>
<h2><a class="anchor" id="building-hila-applications"></a>
Building HILA applications</h2>
<p>First we will try to build and run a health check test application with the default computing platform which is CPU with MPI enabled. To do so navigate to the applications folder and try:</p>
<div class="fragment"><div class="line">cd hila/applications/hila_healthcheck</div>
<div class="line">make -j4</div>
<div class="line">./build/hila_healthcheck</div>
</div><!-- fragment --><details >
<summary >
Expected output </summary>
<p></p>
<div class="fragment"><div class="line">$ ./build/hila_healthcheck </div>
<div class="line">----- HILA ⩩ lattice framework ---------------------------</div>
<div class="line">Running program ./build/hila_healthcheck</div>
<div class="line">with command line arguments &#39;&#39;</div>
<div class="line">Code version: git SHA d0222bca</div>
<div class="line">Compiled Jun  1 2023 at 11:13:10</div>
<div class="line">with options: EVEN_SITES_FIRST SPECIAL_BOUNDARY_CONDITIONS</div>
<div class="line">Starting -- date Thu Jun  1 11:13:28 2023  run time 8.328e-05s</div>
<div class="line">No runtime limit given</div>
<div class="line">GNU c-library performance: not returning allocated memory</div>
<div class="line">----- Reading file parameters ------------------------------</div>
<div class="line">lattice size         256,256,256</div>
<div class="line">random seed          0</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">LAYOUT: lattice size  256 x 256 x 256  =  16777216 sites</div>
<div class="line">Dividing to 1 nodes</div>
<div class="line"> </div>
<div class="line">Sites on node: 256 x 256 x 256  =  16777216</div>
<div class="line">Processor layout: 1 x 1 x 1  =  1 nodes</div>
<div class="line">Node remapping: NODE_LAYOUT_BLOCK with blocksize 4</div>
<div class="line">Node block size 1 1 1  block division 1 1 1</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Communication tests done -- date Thu Jun  1 11:13:31 2023  run time 3.11s</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Random seed from time: 3871436182438</div>
<div class="line">Using node random numbers, seed for node 0: 3871436182438</div>
<div class="line">--- Complex reduction value ( -2.7647453e-17, 5.5294928e-17 ) passed</div>
<div class="line">--- Vector reduction, sum ( -7.1331829e-15, -1.4328816e-15 ) passed</div>
<div class="line">--- Setting and reading a value at [ 37 211 27 ] passed</div>
<div class="line">--- Setting and reading a value at [ 251 220 47 ] passed</div>
<div class="line">--- Setting and reading a value at [ 250 249 134 ] passed</div>
<div class="line">--- Maxloc is [ 112 117 164 ] passed</div>
<div class="line">--- Max value 2 passed</div>
<div class="line">--- Minloc is [ 192 135 27 ] passed</div>
<div class="line">--- Min value -1 passed</div>
<div class="line">--- Field set_elements and get_elements with 51 coordinates passed</div>
<div class="line">--- SiteSelect size 51 passed</div>
<div class="line">--- SiteValueSelect size 51 passed</div>
<div class="line">--- SiteSelect content passed</div>
<div class="line">--- SiteValueSelect content passed</div>
<div class="line">--- SiteIndex passed</div>
<div class="line">--- 2-dimensional slice size 65536 passed</div>
<div class="line">--- slice content passed</div>
<div class="line">--- 1-dimensional slice size 256 passed</div>
<div class="line">--- slice content passed</div>
<div class="line">--- FFT constant field passed</div>
<div class="line">--- FFT inverse transform passed</div>
<div class="line">--- FFT of wave vector [ 132 159 243 ] passed</div>
<div class="line">--- FFT of wave vector [ 167 161 208 ] passed</div>
<div class="line">--- FFT of wave vector [ 152 87 255 ] passed</div>
<div class="line">--- FFT of wave vector [ 156 86 229 ] passed</div>
<div class="line">--- FFT of wave vector [ 78 246 141 ] passed</div>
<div class="line">--- FFT real to complex passed</div>
<div class="line">--- FFT complex to real passed</div>
<div class="line">--- Norm of field = 44434.862 and FFT = 44434.862 passed</div>
<div class="line">--- Norm of binned FFT = 44434.862 passed</div>
<div class="line">--- Binning test at vector [ 100 220 7 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">--- Binning test at vector [ 193 10 49 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">--- Binning test at vector [ 235 241 96 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">TIMER REPORT:             total(sec)          calls     time/call  fraction</div>
<div class="line">---------------------------------------------------------------------------</div>
<div class="line">MPI broadcast       :          0.000             40      0.263 μs   0.0000</div>
<div class="line">MPI reduction       :          0.000             34      2.003 μs   0.0000</div>
<div class="line">FFT total time      :         44.544             14      3.182 s    0.6449</div>
<div class="line"> copy pencils       :          3.261             15      0.217 s    0.0472</div>
<div class="line"> MPI for pencils    :          0.000             90      1.298 μs   0.0000</div>
<div class="line"> FFT plan           :          0.003             42     73.150 μs   0.0000</div>
<div class="line"> copy fft buffers   :          2.412        5505024      0.438 μs   0.0349</div>
<div class="line"> FFT execute        :          2.356        2752512      0.856 μs   0.0341</div>
<div class="line"> pencil reshuffle   :         12.967             30      0.432 s    0.1878</div>
<div class="line"> save pencils       :         26.043             15      1.736 s    0.3771</div>
<div class="line">bin field time      :          9.014              7      1.288 s    0.1305</div>
<div class="line">---------------------------------------------------------------------------</div>
<div class="line"> No communications done from node 0</div>
<div class="line">Finishing -- date Thu Jun  1 11:14:37 2023  run time 69.07s</div>
<div class="line">------------------------------------------------------------</div>
</div><!-- fragment --><p><b>NOTE: Naturally the run time depends on your system</b></p>
<p></p>
</details>
<p>And for running with multiple processes: </p><pre class="fragment">mpirun -n 4 ./build/hila_healthcheck
</pre> <details >
<summary >
Expected output </summary>
<p></p>
<div class="fragment"><div class="line">$ mpirun -n 4 ./build/hila_healthcheck</div>
<div class="line">----- HILA ⩩ lattice framework ---------------------------</div>
<div class="line">Running program ./build/hila_healthcheck</div>
<div class="line">with command line arguments &#39;&#39;</div>
<div class="line">Code version: git SHA d0222bca</div>
<div class="line">Compiled Jun  1 2023 at 11:13:10</div>
<div class="line">with options: EVEN_SITES_FIRST SPECIAL_BOUNDARY_CONDITIONS</div>
<div class="line">Starting -- date Thu Jun  1 11:18:22 2023  run time 0.0001745s</div>
<div class="line">No runtime limit given</div>
<div class="line">GNU c-library performance: not returning allocated memory</div>
<div class="line">----- Reading file parameters ------------------------------</div>
<div class="line">lattice size         256,256,256</div>
<div class="line">random seed          0</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">LAYOUT: lattice size  256 x 256 x 256  =  16777216 sites</div>
<div class="line">Dividing to 4 nodes</div>
<div class="line"> </div>
<div class="line">Sites on node: 256 x 128 x 128  =  4194304</div>
<div class="line">Processor layout: 1 x 2 x 2  =  4 nodes</div>
<div class="line">Node remapping: NODE_LAYOUT_BLOCK with blocksize 4</div>
<div class="line">Node block size 1 2 2  block division 1 1 1</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Communication tests done -- date Thu Jun  1 11:18:23 2023  run time 1.046s</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Random seed from time: 4184648360436</div>
<div class="line">Using node random numbers, seed for node 0: 4184648360436</div>
<div class="line">--- Complex reduction value ( -2.7539926e-17, 5.5079939e-17 ) passed</div>
<div class="line">--- Vector reduction, sum ( 1.4328816e-15, -7.4627804e-15 ) passed</div>
<div class="line">--- Setting and reading a value at [ 139 215 41 ] passed</div>
<div class="line">--- Setting and reading a value at [ 231 44 102 ] passed</div>
<div class="line">--- Setting and reading a value at [ 238 201 150 ] passed</div>
<div class="line">--- Maxloc is [ 80 69 74 ] passed</div>
<div class="line">--- Max value 2 passed</div>
<div class="line">--- Minloc is [ 219 105 178 ] passed</div>
<div class="line">--- Min value -1 passed</div>
<div class="line">--- Field set_elements and get_elements with 51 coordinates passed</div>
<div class="line">--- SiteSelect size 51 passed</div>
<div class="line">--- SiteValueSelect size 51 passed</div>
<div class="line">--- SiteSelect content passed</div>
<div class="line">--- SiteValueSelect content passed</div>
<div class="line">--- SiteIndex passed</div>
<div class="line">--- 2-dimensional slice size 65536 passed</div>
<div class="line">--- slice content passed</div>
<div class="line">--- 1-dimensional slice size 256 passed</div>
<div class="line">--- slice content passed</div>
<div class="line">--- FFT constant field passed</div>
<div class="line">--- FFT inverse transform passed</div>
<div class="line">--- FFT of wave vector [ 239 139 86 ] passed</div>
<div class="line">--- FFT of wave vector [ 218 12 247 ] passed</div>
<div class="line">--- FFT of wave vector [ 94 206 99 ] passed</div>
<div class="line">--- FFT of wave vector [ 34 78 96 ] passed</div>
<div class="line">--- FFT of wave vector [ 221 224 199 ] passed</div>
<div class="line">--- FFT real to complex passed</div>
<div class="line">--- FFT complex to real passed</div>
<div class="line">--- Norm of field = 44418.915 and FFT = 44418.915 passed</div>
<div class="line">--- Norm of binned FFT = 44418.915 passed</div>
<div class="line">--- Binning test at vector [ 106 69 123 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">--- Binning test at vector [ 240 142 174 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">--- Binning test at vector [ 226 28 118 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">TIMER REPORT:             total(sec)          calls     time/call  fraction</div>
<div class="line">---------------------------------------------------------------------------</div>
<div class="line">MPI broadcast       :          0.002             40     49.358 μs   0.0001</div>
<div class="line">MPI reduction       :          0.289             34      8.508 ms   0.0120</div>
<div class="line">MPI post receive    :          0.000              4      1.782 μs   0.0000</div>
<div class="line">MPI start send      :          0.000              4      3.923 μs   0.0000</div>
<div class="line">MPI wait receive    :          0.001              4      0.277 ms   0.0000</div>
<div class="line">MPI wait send       :          0.002              4      0.404 ms   0.0001</div>
<div class="line">MPI send field      :          0.001             15     67.812 μs   0.0000</div>
<div class="line">FFT total time      :         14.922             14      1.066 s    0.6182</div>
<div class="line"> copy pencils       :          1.941             15      0.129 s    0.0804</div>
<div class="line"> MPI for pencils    :          1.644             90     18.263 ms   0.0681</div>
<div class="line"> FFT plan           :          0.006             42      0.140 ms   0.0002</div>
<div class="line"> copy fft buffers   :          1.164        1376256      0.846 μs   0.0482</div>
<div class="line"> FFT execute        :          0.933         688128      1.355 μs   0.0386</div>
<div class="line"> pencil reshuffle   :          7.246             30      0.242 s    0.3002</div>
<div class="line"> save pencils       :          2.994             15      0.200 s    0.1240</div>
<div class="line">bin field time      :          2.792              7      0.399 s    0.1157</div>
<div class="line">---------------------------------------------------------------------------</div>
<div class="line"> COMMS from node 0: 4 done, 0(0%) optimized away</div>
<div class="line">Finishing -- date Thu Jun  1 11:18:46 2023  run time 24.14s</div>
<div class="line">------------------------------------------------------------</div>
</div><!-- fragment --><p> <b>NOTE: Naturally the run time depends on your system</b></p>
<p></p>
</details>
<p>Now we can try to perform the same health check by targeting a differing computing platform with: </p><pre class="fragment">make ARCH=&lt;platform&gt;
</pre><p> where ARCH can take the following values:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ARCH=   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>vanilla</code>   </td><td class="markdownTableBodyNone">default CPU implementation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>AVX2</code>   </td><td class="markdownTableBodyNone">AVX vectorization optimized program using <a href="https://github.com/vectorclass"><em>vectorclass</em></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>openmp</code>   </td><td class="markdownTableBodyNone">OpenMP parallelized program    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>cuda</code>   </td><td class="markdownTableBodyNone">Parallel <a href="https://developer.nvidia.com/cuda-toolkit">CUDA</a> program    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>hip</code>   </td><td class="markdownTableBodyNone">Parallel <a href="https://docs.amd.com/bundle/HIP-Programming-Guide-v5.3/page/Introduction_to_HIP_Programming_Guide.html">HIP</a>   </td></tr>
</table>
<p>TODO: add dependencies to table</p>
<p>For cuda compilation one needs to define their CUDA version and architercure either as environment variables or during the make process:</p>
<div class="fragment"><div class="line">export CUDA_VERSION=11.6</div>
<div class="line">export CUDA_ARCH=61</div>
<div class="line">make ARCH=cuda</div>
<div class="line">or</div>
<div class="line">make ARCH=cuda CUDA_VERSION=11.6 CUDA_ARCH=61</div>
</div><!-- fragment --><p> <em>NOTE: Default cuda version is 11.6 and compute architecture is sm_61</em></p>
<p>Now if we execute the cuda version one should expect the following output</p>
<details >
<summary >
Expected output </summary>
<p></p>
<div class="fragment"><div class="line">$ ./build/hila_healthcheck </div>
<div class="line">GPU devices accessible from node 0: 1</div>
<div class="line">----- HILA ⩩ lattice framework ---------------------------</div>
<div class="line">Running program ./build/hila_healthcheck</div>
<div class="line">with command line arguments &#39;&#39;</div>
<div class="line">Code version: git SHA df945bff</div>
<div class="line">Compiled Jun  2 2023 at 12:57:25</div>
<div class="line">with options: EVEN_SITES_FIRST SPECIAL_BOUNDARY_CONDITIONS</div>
<div class="line">Starting -- date Fri Jun  2 12:58:32 2023  run time 0.08375s</div>
<div class="line">No runtime limit given</div>
<div class="line">Using thread blocks of size 256 threads</div>
<div class="line">Using GPU_AWARE_MPI</div>
<div class="line">ReductionVector with atomic operations (GPU_VECTOR_REDUCTION_THREAD_BLOCKS=0)</div>
<div class="line">CUDA driver version: 12010, runtime 12010</div>
<div class="line">CUDART_VERSION 12010</div>
<div class="line">Device on node rank 0 device 0:</div>
<div class="line">  NVIDIA GeForce GTX 1080  capability: 6.1</div>
<div class="line">  Global memory:   8113MB</div>
<div class="line">  Shared memory:   48kB</div>
<div class="line">  Constant memory: 64kB</div>
<div class="line">  Block registers: 65536</div>
<div class="line">  Warp size:         32</div>
<div class="line">  Threads per block: 1024</div>
<div class="line">  Max block dimensions: [ 1024, 1024, 64 ]</div>
<div class="line">  Max grid dimensions:  [ 2147483647, 65535, 65535 ]</div>
<div class="line">Threads in use: 256</div>
<div class="line">OpenMPI library does not support CUDA-Aware MPI</div>
<div class="line">GPU_AWARE_MPI is defined -- THIS MAY CRASH IN MPI</div>
<div class="line">GNU c-library performance: not returning allocated memory</div>
<div class="line">----- Reading file parameters ------------------------------</div>
<div class="line">lattice size         256,256,256</div>
<div class="line">random seed          0</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">LAYOUT: lattice size  256 x 256 x 256  =  16777216 sites</div>
<div class="line">Dividing to 1 nodes</div>
<div class="line"> </div>
<div class="line">Sites on node: 256 x 256 x 256  =  16777216</div>
<div class="line">Processor layout: 1 x 1 x 1  =  1 nodes</div>
<div class="line">Node remapping: NODE_LAYOUT_BLOCK with blocksize 4</div>
<div class="line">Node block size 1 1 1  block division 1 1 1</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Communication tests done -- date Fri Jun  2 12:58:34 2023  run time 1.827s</div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Random seed from time: 7145975945297229</div>
<div class="line">Using node random numbers, seed for node 0: 7145975945297229</div>
<div class="line">GPU random number generator initialized</div>
<div class="line">GPU random number thread blocks: 32 of size 256 threads</div>
<div class="line">--- Complex reduction value ( -3.9112593e-17, -3.2797116e-18 ) passed</div>
<div class="line">--- Vector reduction, sum ( -7.1331829e-15, -1.3218593e-15 ) passed</div>
<div class="line">--- Setting and reading a value at [ 187 200 25 ] passed</div>
<div class="line">--- Setting and reading a value at [ 70 161 70 ] passed</div>
<div class="line">--- Setting and reading a value at [ 197 191 182 ] passed</div>
<div class="line">--- Maxloc is [ 13 45 107 ] passed</div>
<div class="line">--- Max value 2 passed</div>
<div class="line">--- Minloc is [ 33 24 224 ] passed</div>
<div class="line">--- Min value -1 passed</div>
<div class="line">--- Field set_elements and get_elements with 51 coordinates passed</div>
<div class="line">--- SiteSelect size 51 passed</div>
<div class="line">--- SiteValueSelect size 51 passed</div>
<div class="line">--- SiteSelect content passed</div>
<div class="line">--- SiteValueSelect content passed</div>
<div class="line">--- SiteIndex passed</div>
<div class="line">--- 2-dimensional slice size 65536 passed</div>
<div class="line">--- slice content passed</div>
<div class="line">--- 1-dimensional slice size 256 passed</div>
<div class="line">--- slice content passed</div>
<div class="line">--- FFT constant field passed</div>
<div class="line">--- FFT inverse transform passed</div>
<div class="line">--- FFT of wave vector [ 202 153 38 ] passed</div>
<div class="line">--- FFT of wave vector [ 185 196 66 ] passed</div>
<div class="line">--- FFT of wave vector [ 222 252 82 ] passed</div>
<div class="line">--- FFT of wave vector [ 214 47 8 ] passed</div>
<div class="line">--- FFT of wave vector [ 108 142 205 ] passed</div>
<div class="line">--- FFT real to complex passed</div>
<div class="line">--- FFT complex to real passed</div>
<div class="line">--- Norm of field = 44465.9 and FFT = 44465.9 passed</div>
<div class="line">--- Norm of binned FFT = 44465.9 passed</div>
<div class="line">--- Binning test at vector [ 175 117 16 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">--- Binning test at vector [ 129 107 153 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">--- Binning test at vector [ 237 7 157 ] passed</div>
<div class="line">--- Spectral density test with above vector  passed</div>
<div class="line">TIMER REPORT:             total(sec)          calls     time/call  fraction</div>
<div class="line">---------------------------------------------------------------------------</div>
<div class="line">MPI broadcast       :          0.000             40      0.095 μs   0.0000</div>
<div class="line">MPI reduction       :          0.000             34      0.767 μs   0.0000</div>
<div class="line">FFT total time      :          4.149             14      0.296 s    0.6021</div>
<div class="line"> copy pencils       :          0.000             15      2.560 μs   0.0000</div>
<div class="line"> MPI for pencils    :          4.490             90     49.885 ms   0.6515</div>
<div class="line"> FFT plan           :          0.016              1     16.047 ms   0.0023</div>
<div class="line"> copy fft buffers   :          0.001             84      6.129 μs   0.0001</div>
<div class="line"> FFT execute        :          0.018             42      0.433 ms   0.0026</div>
<div class="line"> pencil reshuffle   :          0.000             30      3.821 μs   0.0000</div>
<div class="line"> save pencils       :          0.000             15      3.851 μs   0.0000</div>
<div class="line">bin field time      :          0.208              7     29.777 ms   0.0302</div>
<div class="line">---------------------------------------------------------------------------</div>
<div class="line"> No communications done from node 0</div>
<div class="line"> </div>
<div class="line">GPU Memory pool statistics from node 0:</div>
<div class="line">   Total pool size 3459.87 MB</div>
<div class="line">   # of allocations 268  real allocs 17%</div>
<div class="line">   Average free list search 6.3 steps</div>
<div class="line">   Average free list size 16 items</div>
<div class="line"> </div>
<div class="line">Finishing -- date Fri Jun  2 12:58:39 2023  run time 6.891s</div>
<div class="line">------------------------------------------------------------</div>
</div><!-- fragment --><p> <b>NOTE: Naturally the run time depends on your system</b></p>
<p></p>
</details>
<p>Additionally we have some ARCH values tuned for specific HPC platforms:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ARCH   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>lumi</code>   </td><td class="markdownTableBodyNone">CPU-MPI implementation for LUMI supercomputer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>lumi-hip</code>   </td><td class="markdownTableBodyNone">GPU-MPI implementation for LUMI supercomputer using HIP    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>mahti</code>   </td><td class="markdownTableBodyNone">CPU-MPI implementation for MAHTI supercomputer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>mahti-cuda</code>   </td><td class="markdownTableBodyNone">GPU-MPI implementation for MAHTI supercomputer using CUDA   </td></tr>
</table>
<p>We will discuss the computing platforms more in the creating a hila application guide.</p>
<h1><a class="anchor" id="user-guide"></a>
User guide</h1>
<p>Now that HILA has been built successfully, the next step is to build your first HILA application: <a class="el" href="md_guide_2hila__applications.html">hila application guide</a></p>
<p>After building your first HILA application one can move on to the comprehensive guide, which describes everything that HILA has to offer: <a class="el" href="md_guide_2hila__functionality.html">comprehensive guide</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
