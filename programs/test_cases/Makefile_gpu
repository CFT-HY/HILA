OPTS = -DNDIM=4

TRANSFORMER = ../../build/transformer -DGPU --GPU
CC = nvcc -DGPU -x cu -I../../../cub/ 

CFLAGS = -O3 $(OPTS)
CXXFLAGS = -O3 $(OPTS)

%.exe: %.tr.o Makefile mersenne_inline.o lattice.o memory.o setup_layout_generic.o map_node_layout_trivial.o
	$(CC) -o $@ $< mersenne_inline.o lattice.o memory.o setup_layout_generic.o map_node_layout_trivial.o

%.cpt: %.cpp Makefile
	../../build/transformer $<

%.tr.o : %.cpt
	$(CC) $(CXXFLAGS) $< -c -o $@

%.o : ../plumbing/%.cpp
	$(CC) $(CXXFLAGS) $< -c

%.o : %.c
	$(CC) $(CFLAGS) $< -c

clean:
	rm -rf *.cpt

cleanall:
	rm -rf *.o *.exe
